(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{351:function(t,e,a){t.exports=a.p+"assets/img/servos-connection.f32ce5d0.png"},551:function(t,e,a){t.exports=a.p+"assets/img/sniffer-connection.fb92e9c6.png"},552:function(t,e,a){t.exports=a.p+"assets/img/app_setup.d8b50db6.png"},553:function(t,e,a){t.exports=a.p+"assets/img/gui_tool.c70e1fa4.png"},554:function(t,e,a){t.exports=a.p+"assets/img/node_properties.bd4d3c27.png"},555:function(t,e,a){t.exports=a.p+"assets/img/subscriber.713b777c.png"},556:function(t,e,a){t.exports=a.p+"assets/img/test_gas_throttle.1e6cd310.gif"},557:function(t,e,a){t.exports=a.p+"assets/img/spark-test.98b0bc3d.png"},558:function(t,e,a){t.exports=a.p+"assets/img/test_spark_ignition.c573f6cc.png"},559:function(t,e,a){t.exports=a.p+"assets/img/starter-test.44930ea0.png"},560:function(t,e,a){t.exports=a.p+"assets/img/test_starter_rpm_and_state.d7895b87.png"},561:function(t,e,a){t.exports=a.p+"assets/img/test_starter_vout_and_current.1911c7af.png"},562:function(t,e,a){t.exports=a.p+"assets/img/test_air_throttle_state.2efc530b.png"},563:function(t,e,a){t.exports=a.p+"assets/img/test_air_throttle_percent.f02753df.png"},564:function(t,e,a){t.exports=a.p+"assets/img/actuators_setup.1b4863ca.png"},565:function(t,e,a){t.exports=a.p+"assets/img/uavcan_status.6522a899.png"},566:function(t,e,a){t.exports=a.p+"assets/img/listener.9136a785.png"},567:function(t,e,a){t.exports=a.p+"assets/img/mavlink_inspector.d1142ac2.png"},568:function(t,e,a){t.exports=a.p+"assets/img/qgc_panel.b3ac1915.png"},569:function(t,e,a){t.exports=a.p+"assets/img/px4_raw_command_initially.040455fa.png"},570:function(t,e,a){t.exports=a.p+"assets/img/px4_raw_command_mr.847b1ca3.png"},571:function(t,e,a){t.exports=a.p+"assets/img/px4_raw_command_fw.355c7c93.png"},572:function(t,e,a){t.exports=a.p+"assets/img/px4_raw_command_land_in_mr.f8747211.png"},573:function(t,e,a){t.exports=a.p+"assets/img/px4_raw_command_landed.120cbc1f.png"},574:function(t,e,a){t.exports=a.p+"assets/img/px4_ice_msg.7e05215a.png"},575:function(t,e,a){t.exports=a.p+"assets/img/px4_ice_rpm.79f22045.png"},776:function(t,e,a){"use strict";a.r(e);var o=a(14),n=Object(o.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_3-dronecan-interface"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-dronecan-interface"}},[t._v("#")]),t._v(" 3. DroneCAN interface")]),t._v(" "),e("p",[t._v("This page is about DroneCAN software related details such as interface, supported features, parameters, configuration and usage example and version history.")]),t._v(" "),e("p",[t._v("This section refers to the latest released version of the software.")]),t._v(" "),e("h2",{attrs:{id:"_3-1-dronecan-interface"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-dronecan-interface"}},[t._v("#")]),t._v(" 3.1. DroneCAN interface")]),t._v(" "),e("p",[t._v("This node interacts with the following messages:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("№")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Message")]),t._v(" "),e("th",[t._v("Meaning")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("sub")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#rawcommand",target:"_blank",rel:"noopener noreferrer"}},[t._v("esc.RawCommand"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Setpoint from PX4 [-8192, 8191]. It controls gas and air throttle, spark ignition and starter: "),e("br"),t._v(" - Negative or zero values are interpreted as a disarmed state where everything is disabled. "),e("br"),t._v(" - Setpoint == 1 enables spark ignition, but doesn't try to enable the starter motor "),e("br"),t._v(" - Setpoint >=2 tries to start the engine with a starter motor")])]),t._v(" "),e("tr",[e("td",[t._v("2")]),t._v(" "),e("td",[t._v("sub")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#arraycommand",target:"_blank",rel:"noopener noreferrer"}},[t._v("actuator.ArrayCommand"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Air throttle open position. This is an optional command that allows you to adjust the open air throttle servo position in real time.")])]),t._v(" "),e("tr",[e("td",[t._v("3")]),t._v(" "),e("td",[t._v("pub")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#status-4",target:"_blank",rel:"noopener noreferrer"}},[t._v("ice.reciprocating.Status"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Feedback from the ICE: RPM, internal node state, temperature and many other fields.")])])])]),t._v(" "),e("p",[t._v("Besides required and highly recommended functions such as "),e("code",[t._v("NodeStatus")]),t._v(" and "),e("code",[t._v("GetNodeInfo")]),t._v(" this node also supports the following application-level functions:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("№")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("message")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("RPC-service")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#uavcanprotocolparam",target:"_blank",rel:"noopener noreferrer"}},[t._v("uavcan.protocol.param"),e("OutboundLink")],1)])]),t._v(" "),e("tr",[e("td",[t._v("2")]),t._v(" "),e("td",[t._v("RPC-service")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#restartnode",target:"_blank",rel:"noopener noreferrer"}},[t._v("uavcan.protocol.RestartNode"),e("OutboundLink")],1)])]),t._v(" "),e("tr",[e("td",[t._v("3")]),t._v(" "),e("td",[t._v("RPC-service")]),t._v(" "),e("td",[e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#gettransportstats",target:"_blank",rel:"noopener noreferrer"}},[t._v("uavcan.protocol.GetTransportStats"),e("OutboundLink")],1)])])])]),t._v(" "),e("h2",{attrs:{id:"_3-2-dronecan-parameters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-dronecan-parameters"}},[t._v("#")]),t._v(" 3.2. DroneCAN parameters")]),t._v(" "),e("p",[t._v("The node has the following parameters:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("№")]),t._v(" "),e("th",[t._v("Register name")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("uavcan.node.id")]),t._v(" "),e("td",[t._v("Defines a node-ID. Allowed values [0,127]. Default value is 42. DNA is not supported, so the node must have a valid ID.")])]),t._v(" "),e("tr",[e("td",[t._v("2")]),t._v(" "),e("td",[t._v("air.cmd")]),t._v(" "),e("td",[t._v("Setpoint source "),e("br"),t._v(" - 0 means es.RawCommand (not supported) "),e("br"),t._v(" - 1 means actuator.ArrayCommand (by default).")])]),t._v(" "),e("tr",[e("td",[t._v("3")]),t._v(" "),e("td",[t._v("air.ch")]),t._v(" "),e("td",[t._v("Index of setpoint channel. [-1; 255]. -1 means disabled")])]),t._v(" "),e("tr",[e("td",[t._v("4")]),t._v(" "),e("td",[t._v("air.opening_duration_ms")]),t._v(" "),e("td",[t._v("Duration of opening the air servo")])]),t._v(" "),e("tr",[e("td",[t._v("5")]),t._v(" "),e("td",[t._v("air.min_closed_initial")]),t._v(" "),e("td",[t._v("PWM duration when air throttle is closed (1500 us by default)")])]),t._v(" "),e("tr",[e("td",[t._v("6")]),t._v(" "),e("td",[t._v("air.max_def_open_goal")]),t._v(" "),e("td",[t._v("PWM duration when air throttle is fully open (1500 us by default)")])]),t._v(" "),e("tr",[e("td",[t._v("7")]),t._v(" "),e("td",[t._v("air.input_rc_min")]),t._v(" "),e("td",[t._v("Min value of input (for RawCommand typically is 1000, for ArrayCommand is -1.0 or 0.0 or 1000.0)")])]),t._v(" "),e("tr",[e("td",[t._v("8")]),t._v(" "),e("td",[t._v("air.input_rc_max")]),t._v(" "),e("td",[t._v("Min value of input (for RawCommand typically is 2000, for ArrayCommand is +1.0 or 1.0 or 1000.0)")])]),t._v(" "),e("tr",[e("td",[t._v("9")]),t._v(" "),e("td",[t._v("throttle.cmd")]),t._v(" "),e("td",[t._v("0 means RawCommand, 1 means ArrayCommand.")])]),t._v(" "),e("tr",[e("td",[t._v("10")]),t._v(" "),e("td",[t._v("throttle.ch")]),t._v(" "),e("td",[t._v("Index of setpoint channel. [-1; 255]. -1 means disabled")])]),t._v(" "),e("tr",[e("td",[t._v("11")]),t._v(" "),e("td",[t._v("throttle.starter.period_on_ms")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("12")]),t._v(" "),e("td",[t._v("throttle.starter.period_off_ms")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("13")]),t._v(" "),e("td",[t._v("throttle.gas.min_def")]),t._v(" "),e("td",[t._v("PWM duration when throttle is 0 (RawCommand is 0 or Command is -1.0)")])]),t._v(" "),e("tr",[e("td",[t._v("14")]),t._v(" "),e("td",[t._v("throttle.gas.max")]),t._v(" "),e("td",[t._v("PWM duration when setpoint is max (RawCommand is 8191 or Command is 1.0)")])]),t._v(" "),e("tr",[e("td",[t._v("15")]),t._v(" "),e("td",[t._v("system.name")]),t._v(" "),e("td",[t._v("Defines custom node name. If empty, the node will use the default name.")])])])]),t._v(" "),e("p",[t._v("The detailed description of some of these parameters is shown in the chapters below.")]),t._v(" "),e("h2",{attrs:{id:"_3-3-configuration-engineering-testing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-configuration-engineering-testing"}},[t._v("#")]),t._v(" 3.3. Configuration / Engineering Testing")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("We strongly recommend that you perform engineering testing prior to installation on a real vehicle, especially if you are using the node for the first time. Testing includes configuring and using the node on a test bench under controlled conditions.")])]),t._v(" "),e("p",[t._v("Hardware requirements:")]),t._v(" "),e("ul",[e("li",[t._v("RL ICE node,")]),t._v(" "),e("li",[t._v("USB-CAN Adapter (CAN-sniffer),")]),t._v(" "),e("li",[t._v("5V servo without load (2 servos are even better)")]),t._v(" "),e("li",[t._v("Multimeter")])]),t._v(" "),e("p",[t._v("Software requirements:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("gui_tool")]),t._v(". Use "),e("a",{attrs:{href:"https://github.com/dronecan/gui_tool",target:"_blank",rel:"noopener noreferrer"}},[t._v("dronecan/gui_tool"),e("OutboundLink")],1),t._v(" on Linux and "),e("a",{attrs:{href:"https://github.com/OpenCyphal-Garage/gui_tool",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenCyphal-Garage/gui_tool"),e("OutboundLink")],1),t._v(" on Windows.")])]),t._v(" "),e("p",[e("strong",[t._v("Step 1. Connect the node properly to a sniffer.")])]),t._v(" "),e("p",[t._v("The simplest connection scheme just for bench testing and configuration is shown below.")]),t._v(" "),e("img",{attrs:{src:a(551),alt:"drawing"}}),t._v(" "),e("p",[e("strong",[t._v("Step 2. Observe the node with gui_tool and set baudrate to 1000000")])]),t._v(" "),e("p",[e("strong",[t._v("Step 2.1. Open gui_tool and set baudrate to 1000000")])]),t._v(" "),e("img",{attrs:{src:a(552),alt:"drawing",width:"600"}}),t._v(" "),e("p",[e("strong",[t._v("Step 2.2. Set the "),e("code",[t._v("Local node ID")]),t._v(". The node name appear in the "),e("code",[t._v("Online nodes")]),t._v(" table")])]),t._v(" "),e("p",[t._v("Apply the Local Node ID by clicking the button in the corresponding field at the top.")]),t._v(" "),e("img",{attrs:{src:a(553),alt:"drawing",width:"600"}}),t._v(" "),e("p",[t._v("The node name is "),e("code",[t._v("co.rl.ice")]),t._v(". The default ID is 42. VSSC can be any value.")]),t._v(" "),e("p",[e("strong",[t._v("Step 2.3. Double click on the node name to get mode details")])]),t._v(" "),e("p",[t._v("You can quickly press 2 times on the node in "),e("code",[t._v("Online nodes")]),t._v(" list. A "),e("code",[t._v("Node Properties")]),t._v(" window should appear. Press "),e("code",[t._v("Fetch All")]),t._v(" button to obtain all the parameters.")]),t._v(" "),e("img",{attrs:{src:a(554),alt:"drawing",width:"600"}}),t._v(" "),e("p",[t._v("You should be able to see additional information such as node name, software version, UID, etc.")]),t._v(" "),e("p",[t._v("The node should respond with the software version that suits you (probably it should be the latest available stable version).")]),t._v(" "),e("p",[e("strong",[t._v("Step 2.4. Open Tools->Subscriber to get feedback")])]),t._v(" "),e("p",[t._v("In the main gui_tool window press "),e("code",[t._v("Tools->Subscriber")]),t._v(" to open a "),e("code",[t._v("Subscriber")]),t._v(" window. Find "),e("code",[t._v("uavcan.equipment.ice.reciprocating.Status")]),t._v(" and then press "),e("code",[t._v("Enter")]),t._v(" or click on the "),e("code",[t._v("Begin Subscription")]),t._v(" button.")]),t._v(" "),e("img",{attrs:{src:a(555),alt:"drawing",width:"400"}}),t._v(" "),e("p",[t._v("This is the main feedback from the node.")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("The "),e("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#status-4",target:"_blank",rel:"noopener noreferrer"}},[t._v("ice.reciprocating.Status"),e("OutboundLink")],1),t._v(" message was probably created for a very specific ICE application. The message has many fields we don't need, and it doesn't have all the fields the node can provide. But this is the best message DroneCAN can provide for our application. Since PX4 currently does nothing with this message, except just log the topic to the SD-card, let's fill these fields with something useful.")])]),t._v(" "),e("p",[t._v("The table of meaning the message fields:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th",[t._v("Original field name")]),t._v(" "),e("th",[t._v("Actual meaning")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("uint6")]),t._v(" "),e("td",[t._v("ecu_index")]),t._v(" "),e("td",[t._v("Gas throttle channel number: 0 - 31")])]),t._v(" "),e("tr",[e("td",[t._v("uint2")]),t._v(" "),e("td",[t._v("state")]),t._v(" "),e("td",[t._v("ICE node state: 0 - STOPPED "),e("br"),t._v(" 1 - RUNNING "),e("br"),t._v(" 2 - WAITING or FINISHER "),e("br"),t._v(" 3 - FAULT")])]),t._v(" "),e("tr",[e("td",[t._v("uint17")]),t._v(" "),e("td",[t._v("engine_speed_rpm")]),t._v(" "),e("td",[t._v("Filtered RPM, 0 - 12000")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("atmospheric_pressure_kpa")]),t._v(" "),e("td",[t._v("Raw RPM, just for logging, 0 - 12000")])]),t._v(" "),e("tr",[e("td",[t._v("uint7")]),t._v(" "),e("td",[t._v("engine_load_percent")]),t._v(" "),e("td",[t._v("Gas throttle, 0 - 100%")])]),t._v(" "),e("tr",[e("td",[t._v("uint7")]),t._v(" "),e("td",[t._v("throttle_position_percent")]),t._v(" "),e("td",[t._v("Air throttle, 0 - 100%")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("oil_temperature")]),t._v(" "),e("td",[t._v("External temperature, Kelvin")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("coolant_temperature")]),t._v(" "),e("td",[t._v("Internal (stm32) temperature, Kelvin")])]),t._v(" "),e("tr",[e("td",[t._v("uint3")]),t._v(" "),e("td",[t._v("spark_plug_usage")]),t._v(" "),e("td",[t._v("Spark plag state: "),e("br"),t._v(" 0 - Disabled "),e("br"),t._v(" 1 - Enabled")])]),t._v(" "),e("tr",[e("td",[t._v("float32")]),t._v(" "),e("td",[t._v("estimated_consumed_fuel_volume_cm3")]),t._v(" "),e("td",[t._v("Spark ignition enabled time "),e("br"),t._v(" 0 - ignition disabled "),e("br"),t._v(" [1; +inf] - milliseconds from start")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("intake_manifold_temperature")]),t._v(" "),e("td",[t._v("current")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("intake_manifold_pressure_kpa")]),t._v(" "),e("td",[t._v("voltage 5v")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("oil_pressure")]),t._v(" "),e("td",[t._v("voltage vin")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("fuel_pressure")]),t._v(" "),e("td",[t._v("voltage vout")])]),t._v(" "),e("tr",[e("td",[t._v("float16")]),t._v(" "),e("td",[t._v("spark_dwell_time_ms")]),t._v(" "),e("td",[t._v("-")])]),t._v(" "),e("tr",[e("td",[t._v("float32")]),t._v(" "),e("td",[t._v("fuel_consumption_rate_cm3pm")]),t._v(" "),e("td",[t._v("-")])]),t._v(" "),e("tr",[e("td",[t._v("uint30")]),t._v(" "),e("td",[t._v("flags")]),t._v(" "),e("td",[t._v("Firmware git hash")])])])]),t._v(" "),e("p",[t._v("Check that these fields meets your expectation.")]),t._v(" "),e("p",[e("strong",[t._v("Step 3. Configure the node in relation to your application.")])]),t._v(" "),e("p",[e("strong",[t._v("1.")]),t._v(" Set "),e("code",[t._v("uavcan.node.id")]),t._v(" in relation to your application. The node ID should be unique within the CAN network to avoid ID collisions. For testing purpose, you can keep the default ID=42.")]),t._v(" "),e("p",[e("strong",[t._v("2.")]),t._v(" Configure air throttle "),e("code",[t._v("air.*")]),t._v(" parameters:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("air.cmd")]),t._v(" should be 1. It means that the node will use "),e("code",[t._v("actuator.ArrayCommand")]),t._v(" as setpoint. Other setpoint types are not supported at the moment.")]),t._v(" "),e("li",[e("code",[t._v("air.ch")]),t._v(" should be configured in relation to your application. For testing purposes, you can just set "),e("code",[t._v("-1")]),t._v(" to disable it. This feature is useful for long-term usage with different environment conditions because it allows to adjust an open air throttle position in real time with "),e("code",[t._v("actuator.ArrayCommand")]),t._v(", but you always can do it with the parameters.")]),t._v(" "),e("li",[e("code",[t._v("air.opening_duration_ms")]),t._v(". Keep 1500 ms, you can ajust it later.")]),t._v(" "),e("li",[e("code",[t._v("air.min_closed_initial")]),t._v(" and "),e("code",[t._v("air.max_def_open_goal")]),t._v(" parameters define the PWM range to control an air throttle.")]),t._v(" "),e("li",[e("code",[t._v("air.input_rc_min")]),t._v(" and "),e("code",[t._v("air.input_rc_max")]),t._v(". Keep the default values You can ajust them later if you need.")])]),t._v(" "),e("p",[e("strong",[t._v("3.")]),t._v(" Configure basic "),e("code",[t._v("throttle.*")]),t._v(" parameters:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("throttle.cmd")]),t._v(" should be 0. It means that the node will use "),e("code",[t._v("esc.RawCommand")]),t._v(" as setpoint. Other setpoint types are not supported at the moment.")]),t._v(" "),e("li",[e("code",[t._v("throttle.ch")]),t._v(" should be configured in relation to your airframe. By default it is "),e("code",[t._v("7")]),t._v(" because it suits a specific PX4 airframe, so you probably want to change it. For testing purposes you can keep the default value")])]),t._v(" "),e("p",[e("strong",[t._v("4.")]),t._v(" Configure "),e("code",[t._v("throttle.starter.*")]),t._v(" parameters. "),e("code",[t._v("period_on_ms")]),t._v(" and "),e("code",[t._v("period_off_ms")]),t._v(" define the duration of attempt to initiate the combustion process. During the first period, the starter motor is enabled, during the second period the node checks if the engine fires and begins to run. For testing purposes, you can keep the default values 3000 ms and 500 ms. You can adjust it later.")]),t._v(" "),e("p",[e("strong",[t._v("5.")]),t._v(" Configure "),e("code",[t._v("throttle.gas.*")]),t._v(" parameters. The parameters "),e("code",[t._v("min_def")]),t._v(" and "),e("code",[t._v("max")]),t._v(" define the PWM range to control a gas throttle.")]),t._v(" "),e("p",[t._v("The furher steps rely on that you have everyting by default except:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("air.min_closed_initial = 1300")])]),t._v(" "),e("li",[e("code",[t._v("air.max_def_open_goal = 1700")])]),t._v(" "),e("li",[e("code",[t._v("throttle.gas.min_def = 1300")])]),t._v(" "),e("li",[e("code",[t._v("throttle.gas.max = 1700")])])]),t._v(" "),e("p",[e("strong",[t._v("Step 4. Test gas throttle")])]),t._v(" "),e("p",[t._v("Connect a 5V servo without load to the node via "),e("code",[t._v("Throttle PWM")]),t._v(", "),e("code",[t._v("5V")]),t._v(" and "),e("code",[t._v("GND")]),t._v(" pins as show on the scheme below:")]),t._v(" "),e("img",{attrs:{src:a(351),alt:"drawing"}}),t._v(" "),e("p",[e("strong",[t._v("1.")]),t._v(" Open "),e("code",[t._v("ESC Management Panel")]),t._v(". Optionally create a plot with "),e("code",[t._v("uavcan.equipment.ice.reciprocating.Status")]),t._v(" message and "),e("code",[t._v("msg.engine_load_percent")]),t._v(" field.")]),t._v(" "),e("p",[e("strong",[t._v("2.")]),t._v(" Move the slider and verify that the servo rotates and the value on the plot changes as well.")]),t._v(" "),e("p",[e("strong",[t._v("3.")]),t._v(" Press "),e("code",[t._v("Pause")]),t._v(" button. After 500 ms the node should move the servo to the default position. This is a safery feature. If the node loose the setpoint, it should turn everything off including moving the gas servo to the closed position.")]),t._v(" "),e("img",{attrs:{src:a(556),alt:"drawing",width:"600"}}),t._v(" "),e("p",[e("strong",[t._v("Step 5. Test spark ignition control")])]),t._v(" "),e("img",{attrs:{src:a(557),alt:"drawing"}}),t._v(" "),e("p",[t._v("When the gas throttle setpoint (esc.RawCommand) is >= 0, the spark ignition is enabled, otherwise it is disabled.")]),t._v(" "),e("p",[t._v("You can create a plot here:")]),t._v(" "),e("img",{attrs:{src:a(558),alt:"drawing",width:"600"}}),t._v(" "),e("p",[e("strong",[t._v("Step 6. Test starter motor control")])]),t._v(" "),e("img",{attrs:{src:a(559),alt:"drawing"}}),t._v(" "),e("p",[t._v("When the gas throttle setpoint (esc.RawCommand) is >= 1, the node tries to fire up the engine and periodically enable starter.")]),t._v(" "),e("p",[t._v("On a bench you typically don't have a connected starter motor and Electronic Ignition Module, let's study this use case.")]),t._v(" "),e("p",[t._v("Let's try to fire up the engine 4 times and plot the following 4 fields:")]),t._v(" "),e("img",{attrs:{src:a(560),alt:"drawing",width:"600"}}),t._v(" "),e("img",{attrs:{src:a(561),alt:"drawing",width:"600"}}),t._v(" "),e("p",[t._v("The first plot is about RPM feedback. Since it is not connected, it is 0 and all attemps to fire up were failed.")]),t._v(" "),e("p",[t._v("The second plot is about internal node state: 0 - stopped, 1 -running, 2 - waiting or finished. By default, the node enables starter for 3000 ms and wait for 500 ms. The whole period is 3500 ms.")]),t._v(" "),e("p",[t._v("The third plot is Vout voltage. Since a starter motor is not connected, it is not enough time for voltage to go down beetween attempts.")]),t._v(" "),e("p",[t._v("The fourth plot is about current. Since a starter motor is not connected, it is just 0 Ampers.")]),t._v(" "),e("p",[t._v("A real use case is considered later.")]),t._v(" "),e("p",[e("strong",[t._v("Step 7. Test air throttle control")])]),t._v(" "),e("p",[t._v("Connect a servo to "),e("code",[t._v("AIR PWM")]),t._v(", "),e("code",[t._v("5V")]),t._v(" and "),e("code",[t._v("GND")]),t._v(" pins as show on the scheme below:")]),t._v(" "),e("img",{attrs:{src:a(351),alt:"drawing"}}),t._v(" "),e("p",[t._v("Air throttle position depends on the node state.")]),t._v(" "),e("p",[t._v("Let's consider the similar use case as above: the starter and EIM are not connected, 4 attemtps to fire up the engine. We can plot the 2 fields:")]),t._v(" "),e("img",{attrs:{src:a(562),alt:"drawing",width:"600"}}),t._v(" "),e("img",{attrs:{src:a(563),alt:"drawing",width:"600"}}),t._v(" "),e("p",[t._v("The first plot is about internal node state.")]),t._v(" "),e("p",[t._v("The second plot is air throttle position.")]),t._v(" "),e("p",[e("strong",[t._v("Step 8. Test stm32 and external temperature")])]),t._v(" "),e("p",[t._v("The message fields are:")]),t._v(" "),e("ul",[e("li",[t._v("coolant_temperature - Internal (stm32) temperature, Kelvin")]),t._v(" "),e("li",[t._v("oil_temperature - ICE temperature, Kelvin, need an external temperature sensor")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Add a connection scheme for an external temperature sensor here!")])]),t._v(" "),e("p",[e("strong",[t._v("Step 9. Test RPM measurement")])]),t._v(" "),e("p",[t._v("The message fields are:")]),t._v(" "),e("ul",[e("li",[t._v("engine_speed_rpm - Filtered RPM, 0 - 12000")]),t._v(" "),e("li",[t._v("atmospheric_pressure_kpa - Raw RPM, just for logging")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("If you perform bench testing, there is a simple way to check RPM measurement feature. Since "),e("code",[t._v("AIR PWM")]),t._v(" and "),e("code",[t._v("Throttle PWM")]),t._v(" are PWM with 50 Hz frequency, you can connect it with "),e("code",[t._v("Motor speed")]),t._v(" pin. If the RPM measurement is fine, the node should measure 3000 RPM.")])]),t._v(" "),e("h2",{attrs:{id:"_3-4-px4-integration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-px4-integration"}},[t._v("#")]),t._v(" 3.4. PX4 integration")]),t._v(" "),e("p",[t._v("The following parameters are required to be configured:")]),t._v(" "),e("ul",[e("li",[t._v("UAVCAN_ENABLE=3")]),t._v(" "),e("li",[t._v("UAVCAN_SUB_ICE=1")])]),t._v(" "),e("p",[t._v("It is recommended using PX4 at least v1.13.3 or newer and "),e("a",{attrs:{href:"https://www.youtube.com/watch?v=NQwepGLMzZ4",target:"_blank",rel:"noopener noreferrer"}},[t._v("New Dynamic Mixing System"),e("OutboundLink")],1),t._v(". Please, just follow the official "),e("a",{attrs:{href:"https://docs.px4.io/main/en/config/actuators.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Actuator Configuration and Testing"),e("OutboundLink")],1),t._v(" docs.")]),t._v(" "),e("p",[t._v("The ICE node expects you to use the default config for the ICE channel: Minimum value should 1 and Maximum value should be 8191.")]),t._v(" "),e("p",[t._v("Let's look at an example of a Generic "),e("code",[t._v("Standard VTOL airframe")]),t._v(" in detail and explain how the ICE node works in different situations. Let's configure ESC 1-4 as quadcopter ESC and ESC 5 as ICE. The control surfaces (ailerons, elevators, rudders) are configured as Servos and they are out of scope of this example. Below there is an example of configuration where ESC 5 is ICE:")]),t._v(" "),e("img",{attrs:{src:a(564),alt:"drawing",width:"300"}}),t._v(" "),e("p",[t._v("If the ICE node is succesfully connected to the autpilot, you should see the node when type "),e("code",[t._v("uavcan status")]),t._v(" command in MAVLink console. An example of output could be:")]),t._v(" "),e("img",{attrs:{src:a(565),alt:"drawing",width:"300"}}),t._v(" "),e("p",[t._v("Type "),e("code",[t._v("listener internal_combustion_engine_status")]),t._v(" to check the node feedback. An example output is:")]),t._v(" "),e("img",{attrs:{src:a(566),alt:"drawing",width:"300"}}),t._v(" "),e("p",[t._v("If you see that the ice status message is published in UORB, you should be able to see it in MAVLink Inspector as well that is useful for debugging:")]),t._v(" "),e("img",{attrs:{src:a(567),alt:"drawing",width:"500"}}),t._v(" "),e("p",[t._v("You can also move some fields of the "),e("code",[t._v("EFI_STATUS")]),t._v(" message into a QGC panel:")]),t._v(" "),e("img",{attrs:{src:a(568),alt:"drawing",width:"300"}}),t._v(" "),e("p",[t._v("Let's study how does ICE node works in details.")]),t._v(" "),e("p",[e("strong",[t._v("1.")]),t._v(" Initially the autopilot sends an empty "),e("code",[t._v("esc.RawCommand")]),t._v(" command. ICE node ignores this command because it doesn't have a required channel. The node automatically disable everything if it doesn't receive the required channel for 500 ms.")]),t._v(" "),e("img",{attrs:{src:a(569),alt:"drawing",width:"500"}}),t._v(" "),e("p",[e("strong",[t._v("2.")]),t._v(" In MR mode the autopilot sends commands to ESC1-4, but not for ESC5 yet. The command can be as shown below:")]),t._v(" "),e("img",{attrs:{src:a(570),alt:"drawing",width:"500"}}),t._v(" "),e("p",[t._v("Since the message doesn't have a required for the ICE node channel, the node ignores this command as well.")]),t._v(" "),e("p",[e("strong",[t._v("3.")]),t._v(" In FW mode the autopilot turns off all quadcopter related motors and adds the 5th channel as shown below:")]),t._v(" "),e("img",{attrs:{src:a(571),alt:"drawing",width:"500"}}),t._v(" "),e("p",[t._v("Now the ICE node is engaged: it controls the gas and air throttle servos, the starter motor and the spark ignition. The minimal command value is 1 and the maximum in 8191 as configured above.")]),t._v(" "),e("p",[e("strong",[t._v("4.")]),t._v(" When we go back to the MR mode, the autopilot sends command to MR related motors again, but this time it includes 0 value for the ICE node:")]),t._v(" "),e("img",{attrs:{src:a(572),alt:"drawing",width:"500"}}),t._v(" "),e("p",[t._v("Zero setpoint forces the ICE node to turn off everything imideately.")]),t._v(" "),e("p",[e("strong",[t._v("5.")]),t._v(" After landing the PX4 sends the following command:")]),t._v(" "),e("img",{attrs:{src:a(573),alt:"drawing",width:"500"}}),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("Add info about the custom PX4 version...")])]),t._v(" "),e("h2",{attrs:{id:"_3-5-functional-testing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-functional-testing"}},[t._v("#")]),t._v(" 3.5 Functional testing")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("We recommend testing the ICE node is a safe conditions before a real flight. Take care about the safety!")])]),t._v(" "),e("p",[t._v("After the ICE node is configured, mounted on a vehicle and succesfully connected with PX4-autopilot, try the node on the ground.")]),t._v(" "),e("p",[t._v("On the video below the node was tested with ICE DLE 35RA and starter EME35 (by the way, this is the only recommended setup) with empty fuel tank without quadcopter motors. The pilot switched the vehicle into FW mode.")]),t._v(" "),e("p",[t._v("Click on the video:")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://youtu.be/MvhyospAkns",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.youtube.com/vi/MvhyospAkns/0.jpg",alt:"drawing",width:"400"}}),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("1. Starter")]),t._v(". We can see 3 clear attemps of the starter motor to fire up the engine. Here the attempt duration is 4000 ms and the delay is 1500 ms.")]),t._v(" "),e("p",[e("strong",[t._v("2. Air throttle")]),t._v(". You can also see the air throttle servo moving beetween the closed and open positions.")]),t._v(" "),e("p",[e("strong",[t._v("3. Gas throttle")]),t._v(". In the beginning you can also see a movement of the gas throttle servo. The throttle had a fixed position. You can rotate it to see the gas throttle actuatual changes.")]),t._v(" "),e("p",[e("strong",[t._v("4. Spark ignition")]),t._v(". Additionally, you can connect a multimeter to verify that the spark ignition is correctly controlled.")]),t._v(" "),e("p",[t._v("After this test the vehicle is ready for tests with fuel.")]),t._v(" "),e("h2",{attrs:{id:"_3-6-real-usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-real-usage"}},[t._v("#")]),t._v(" 3.6 Real usage")]),t._v(" "),e("p",[t._v("This node has been successfully tested on VTOL. Here is an example of RPM and esc.RawCommand values collected from one of the flight logs.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("img",{attrs:{src:a(574),alt:"drawing",height:"200"}})]),t._v(" "),e("td",[e("img",{attrs:{src:a(575),alt:"drawing",height:"200"}})])])])]),t._v(" "),e("h2",{attrs:{id:"_3-7-software-versions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-software-versions"}},[t._v("#")]),t._v(" 3.7. Software versions")]),t._v(" "),e("p",[t._v("History of all releases and changes related to the node:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Version")]),t._v(" "),e("th",[t._v("Date")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/RaccoonlabDev/docs/releases/tag/v0.4.3-ice",target:"_blank",rel:"noopener noreferrer"}},[t._v("v0.4.3 9d466be"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Jul 14, 2024")]),t._v(" "),e("td",[t._v("First beta release")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/RaccoonlabDev/docs/releases/tag/v0.4.5",target:"_blank",rel:"noopener noreferrer"}},[t._v("v0.3.4_98e6371"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Dec 27, 2021")]),t._v(" "),e("td",[t._v("Alpha release")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/RaccoonlabDev/docs/releases/tag/v0.3.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("v0.3.2_8b0c6cf"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Jun 10, 2021")]),t._v(" "),e("td",[t._v("Alpha release")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://github.com/RaccoonlabDev/docs/releases/tag/v0.3.0-alpha",target:"_blank",rel:"noopener noreferrer"}},[t._v("v0.3.0_7baa09b"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("Apr 5, 2021")]),t._v(" "),e("td",[t._v("Alpha release")])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);