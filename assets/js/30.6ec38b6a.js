(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{275:function(e,t,n){e.exports=n.p+"assets/img/lw20_i2c.82bad2a4.png"},340:function(e,t,n){e.exports=n.p+"assets/img/lw20_i2c.5a22b588.png"},653:function(e,t,n){e.exports=n.p+"assets/img/dronecan_gui_tool.f7445e3a.png"},654:function(e,t,n){e.exports=n.p+"assets/img/node_info.f35d872d.png"},655:function(e,t,n){e.exports=n.p+"assets/img/params.b902cd86.png"},656:function(e,t,n){e.exports=n.p+"assets/img/msg.6bf36af3.png"},657:function(e,t,n){e.exports=n.p+"assets/img/plot.e8f6674a.png"},658:function(e,t,n){e.exports=n.p+"assets/img/px4_mavlink_inspector.2a2682d2.png"},659:function(e,t,n){e.exports=n.p+"assets/img/px4_mavlink_console.c797be0a.png"},660:function(e,t,n){e.exports=n.p+"assets/img/px4_listener_distance_sensor.486d2289.png"},799:function(e,t,n){"use strict";n.r(t);var a=n(14),o=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"_6-dronecan-interface"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-dronecan-interface"}},[e._v("#")]),e._v(" 6. DroneCAN Interface")]),e._v(" "),t("p",[e._v("This page is about DroneCAN related details such as interface, supported features, parameters, configuration and usage examples and software versions. For general information, refer to the "),t("RouterLink",{attrs:{to:"/guide/rangefinder/"}},[e._v("1. General")]),e._v(" page., for hardware related details including connection example scheme please refer "),t("RouterLink",{attrs:{to:"/guide/rangefinder/hardware.html"}},[e._v("2. Adapter Hardware")]),e._v(".")],1),e._v(" "),t("p",[e._v("This section is related to the latest released version of the software.")]),e._v(" "),t("h2",{attrs:{id:"_6-1-dronecan-interface"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-dronecan-interface"}},[e._v("#")]),e._v(" 6.1. DroneCAN Interface")]),e._v(" "),t("p",[e._v("This node interacts with following messages:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("№")]),e._v(" "),t("th",[e._v("Type")]),e._v(" "),t("th",[e._v("Message")]),e._v(" "),t("th",[e._v("Rate")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("1")]),e._v(" "),t("td",[e._v("publisher")]),e._v(" "),t("td",[t("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#measurement",target:"_blank",rel:"noopener noreferrer"}},[e._v("uavcan.equipment.range_sensor.Measurement"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("10 - 100 Hz")])]),e._v(" "),t("tr",[t("td",[e._v("2")]),e._v(" "),t("td",[e._v("publisher")]),e._v(" "),t("td",[t("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#circuitstatus",target:"_blank",rel:"noopener noreferrer"}},[e._v("uavcan.equipment.power.CircuitStatus"),t("OutboundLink")],1)]),e._v(" "),t("td",[e._v("2 Hz")])])])]),e._v(" "),t("p",[e._v("Besides required and highly recommended functions such as "),t("code",[e._v("NodeStatus")]),e._v(" and "),t("code",[e._v("GetNodeInfo")]),e._v(" this node also supports the following application-level functions:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("№")]),e._v(" "),t("th",[e._v("Type")]),e._v(" "),t("th",[e._v("Message")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("1")]),e._v(" "),t("td",[e._v("RPC-service")]),e._v(" "),t("td",[t("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#uavcanprotocolparam",target:"_blank",rel:"noopener noreferrer"}},[e._v("uavcan.protocol.param"),t("OutboundLink")],1)])]),e._v(" "),t("tr",[t("td",[e._v("2")]),e._v(" "),t("td",[e._v("RPC-service")]),e._v(" "),t("td",[t("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#restartnode",target:"_blank",rel:"noopener noreferrer"}},[e._v("uavcan.protocol.RestartNode"),t("OutboundLink")],1)])]),e._v(" "),t("tr",[t("td",[e._v("3")]),e._v(" "),t("td",[e._v("RPC-service")]),e._v(" "),t("td",[t("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#gettransportstats",target:"_blank",rel:"noopener noreferrer"}},[e._v("uavcan.protocol.GetTransportStats"),t("OutboundLink")],1)])])])]),e._v(" "),t("h2",{attrs:{id:"_6-2-dronecan-parameters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-dronecan-parameters"}},[e._v("#")]),e._v(" 6.2. DroneCAN Parameters")]),e._v(" "),t("p",[e._v("The node has the following DroneCAN related registers:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("№")]),e._v(" "),t("th",[e._v("Register name")]),e._v(" "),t("th",[e._v("Description")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("1")]),e._v(" "),t("td",[e._v("uavcan.node.id")]),e._v(" "),t("td",[e._v("Defines a node-ID. Allowed values [0,127].")])]),e._v(" "),t("tr",[t("td",[e._v("2")]),e._v(" "),t("td",[e._v("system.name")]),e._v(" "),t("td",[e._v("Defines custom node name. If empty, the node will use the default name.")])]),e._v(" "),t("tr",[t("td",[e._v("3")]),e._v(" "),t("td",[e._v("uavcan.node.description")]),e._v(" "),t("td",[e._v("User/integrator-defined, human-readable description of this specific node.")])]),e._v(" "),t("tr",[t("td",[e._v("4")]),e._v(" "),t("td",[e._v("system.internal")]),e._v(" "),t("td",[e._v("Reserved")])]),e._v(" "),t("tr",[t("td",[e._v("5")]),e._v(" "),t("td",[e._v("system.protocol")]),e._v(" "),t("td",[e._v("Defines the protocol: "),t("br"),e._v(" 0 - Auto (always DroneCAN at the moment) "),t("br"),e._v(" 1 - Cyphal "),t("br"),e._v(" 2 - DroneCAN")])]),e._v(" "),t("tr",[t("td",[e._v("6")]),e._v(" "),t("td",[e._v("range.type")]),e._v(" "),t("td",[e._v("Defines which sensor to use: "),t("br"),e._v(" 0 - LW20/C (i2c) "),t("br"),e._v(" 1 - TF-Luna (uart) "),t("br"),e._v(" 2 - Garmin lite v3 (i2c) "),t("br"),e._v(" 3 - vl53l0x (i2c)")])]),e._v(" "),t("tr",[t("td",[e._v("7")]),e._v(" "),t("td",[e._v("range.dronecan_sensor_id")]),e._v(" "),t("td",[e._v("sensor_id in DroneCAN "),t("a",{attrs:{href:"https://dronecan.github.io/Specification/7._List_of_standard_data_types/#measurement",target:"_blank",rel:"noopener noreferrer"}},[e._v("Measurement"),t("OutboundLink")],1),e._v(" message")])])])]),e._v(" "),t("blockquote",[t("p",[e._v("Generated on Dec 03, 2023 for rangefinder_v1.6.0_e30e0394.")])]),e._v(" "),t("h2",{attrs:{id:"_6-3-getting-started-bench-test"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-getting-started-bench-test"}},[e._v("#")]),e._v(" 6.3. Getting started (bench test)")]),e._v(" "),t("p",[e._v("Before mounting on a real vehicle, especially when using the node for the first time, it is recommended to test the node and perform configuration on a bench using "),t("a",{attrs:{href:"https://github.com/dronecan/gui_tool",target:"_blank",rel:"noopener noreferrer"}},[e._v("gui_tool"),t("OutboundLink")],1),e._v(". This utility allows to easily use the full functionality of the node.")]),e._v(" "),t("p",[t("strong",[e._v("Step 1. Connect the node to a sniffer. The node should blink.")])]),e._v(" "),t("p",[e._v("An example of connection scheme just for bench testing and configuration is shown below.")]),e._v(" "),t("img",{attrs:{src:n(340),alt:"drawing",width:"640"}}),e._v(" "),t("img",{attrs:{src:n(275),alt:"drawing",width:"640"}}),e._v(" "),t("p",[e._v("Alternatively, in a vehicle you may want to connect the node via Molex CAN connector.")]),e._v(" "),t("p",[e._v("By the LED color you can determine the node state:")]),e._v(" "),t("ul",[t("li",[e._v("Orange blinking means either something is not properly configured or something wrong.")]),e._v(" "),t("li",[e._v("Red blinking means some critical error. It is related to a software or hardware issue.")]),e._v(" "),t("li",[e._v("Normally, the node should blink with blue color.")])]),e._v(" "),t("p",[e._v("Please, refer to the "),t("a",{attrs:{href:"https://docs.raccoonlab.co/guide/intro/leds.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("LED meaning page"),t("OutboundLink")],1),e._v(" for details.")]),e._v(" "),t("p",[t("strong",[e._v("Step 2. Open gui_tool and set the local node ID. The node should send data and respond to GetNodeInfo")])]),e._v(" "),t("p",[e._v("Open "),t("code",[e._v("gui_tool")]),e._v(". Apply the "),t("code",[e._v("Local Node ID")]),e._v(" by clicking the button in the corresponding field at the top. Check that the node publishes some data like "),t("code",[e._v("NodeStatus")]),e._v(" and "),t("code",[e._v("GetNodeInfo")]),e._v(". Basically, it means that it should show: Name, Mode, Health and Uptime.")]),e._v(" "),t("p",[t("img",{attrs:{src:n(653),alt:"dronecan_gui_tool",title:"dronecan_gui_tool"}})]),e._v(" "),t("p",[e._v("You can quickly press 2 times on the node in "),t("code",[e._v("Online nodes")]),e._v(" list. You should be able to see additional information such as node name, software version, UID, etc.")]),e._v(" "),t("p",[t("img",{attrs:{src:n(654),alt:"msg",title:"msg"}})]),e._v(" "),t("p",[e._v("The node should respond with the software version that suits you (probably it should be the latest available stable version).")]),e._v(" "),t("blockquote",[t("p",[e._v("If your node doesn't send "),t("code",[e._v("GetNodeInfo")]),e._v(" it probably means that your gui_tool is still in anonymous mode. Apply local node ID.")])]),e._v(" "),t("p",[t("strong",[e._v("Step 3. Configure paramters, store them and reboot the node. Paramters should be updated.")])]),e._v(" "),t("p",[e._v("Basically, you need to interract with a few parameters only:")]),e._v(" "),t("ol",[t("li",[e._v("Select the node ID by changing "),t("code",[e._v("uavcan.node_id")]),e._v(" that fits your CAN-network without ID-collision. Default value is 50.")]),e._v(" "),t("li",[e._v("Choose your rangefinder sensor with "),t("code",[e._v("range.type")]),e._v(" parameter.")])]),e._v(" "),t("p",[e._v("Optionally, you can also configure the following parameters:")]),e._v(" "),t("ol",[t("li",[e._v("Set "),t("code",[e._v("range.dronecan_sensor_id")]),e._v(" if you have more than 1 DroneCAN rangefinder.")]),e._v(" "),t("li",[e._v("Set "),t("code",[e._v("uavcan.node.description")]),e._v(" with a description of your node. It doesn't diractly effect on anything, but allows you to easier differentiate the nodes between each other")]),e._v(" "),t("li",[e._v("Set "),t("code",[e._v("system.name")]),e._v(" if you want to use a custom node name. The default name is "),t("code",[e._v("co.raccoonlab.rangefinder")]),e._v(".")])]),e._v(" "),t("p",[e._v("If you want to switch protocol to Cyphal, you need to set "),t("code",[e._v("system.protocol")]),e._v(" to 1.")]),e._v(" "),t("p",[e._v("Stora All parameters and Reboot the node.")]),e._v(" "),t("p",[t("img",{attrs:{src:n(655),alt:"",title:"msg"}})]),e._v(" "),t("p",[t("strong",[e._v("Step 4. Open subscriber panel. The node should publish range_sensor.Measurement.")])]),e._v(" "),t("p",[e._v("Below you can see an example of a messages.")]),e._v(" "),t("p",[t("img",{attrs:{src:n(656),alt:"msg",title:"msg"}})]),e._v(" "),t("p",[e._v("You can also try "),t("code",[e._v("Tools->Plotter")]),e._v(" and create a plot with measurements.")]),e._v(" "),t("p",[t("img",{attrs:{src:n(657),alt:"plot",title:"plot"}})]),e._v(" "),t("h2",{attrs:{id:"_6-4-px4-integration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-px4-integration"}},[e._v("#")]),e._v(" 6.4. PX4 integration")]),e._v(" "),t("p",[e._v("The node has been tested multiple times on the VTOL application with autopilot based on PX4 with defferent version (v1.12, v1.13, etc).")]),e._v(" "),t("p",[t("strong",[e._v("Step 1. Configure parameters")])]),e._v(" "),t("p",[e._v("Typically, you need to setup the following "),t("a",{attrs:{href:"https://docs.px4.io/main/en/advanced_config/parameter_reference.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("PX4 parameters"),t("OutboundLink")],1),e._v(":")]),e._v(" "),t("ul",[t("li",[e._v("UAVCAN_ENABLE must be non zero")]),e._v(" "),t("li",[e._v("UAVCAN_SUB_RNG must be Enabled")]),e._v(" "),t("li",[e._v("UAVCAN_RNG_MIN")]),e._v(" "),t("li",[e._v("UAVCAN_RNG_MAX")])]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Lidar")]),e._v(" "),t("th",[e._v("UAVCAN_RNG_MIN")]),e._v(" "),t("th",[e._v("UAVCAN_RNG_MAX")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("LightWare LW20/C")]),e._v(" "),t("td",[e._v("0")]),e._v(" "),t("td",[e._v("100.0")])]),e._v(" "),t("tr",[t("td",[e._v("Benewake TFmini LiDAR")]),e._v(" "),t("td",[e._v("0")]),e._v(" "),t("td",[e._v("12.0")])]),e._v(" "),t("tr",[t("td",[e._v("Garmin Lidar-Lite")]),e._v(" "),t("td",[e._v("0")]),e._v(" "),t("td",[e._v("40.0")])])])]),e._v(" "),t("p",[e._v("Reboot the vehicle after the configuration.")]),e._v(" "),t("p",[t("strong",[e._v("Step 2. Check the distance sensor in Mavlink Inspector")])]),e._v(" "),t("p",[t("img",{attrs:{src:n(658),alt:"px4_mavlink_inspector",title:"px4_mavlink_inspector"}})]),e._v(" "),t("p",[e._v("Verify that max and min distances are correct and current_distance is adequate. The distance is shown in centimeters.")]),e._v(" "),t("p",[t("strong",[e._v("Step 3. Troubleshooting")])]),e._v(" "),t("p",[e._v("If distance sensor is not appeared in Mavlink Inspector, try to repeat the previous steps.")]),e._v(" "),t("p",[e._v("It can be useful to run "),t("code",[e._v("uavcan status")]),e._v(" in "),t("code",[e._v("Mavlink Console")]),e._v(":")]),e._v(" "),t("img",{attrs:{src:n(659),alt:"drawing",width:"320"}}),e._v(" "),t("ol",[t("li",[e._v("If the node is not online, it means the problem with physical connection.")]),e._v(" "),t("li",[e._v("If the node is not "),t("code",[e._v("OK")]),e._v(" and "),t("code",[e._v("OPERAT")]),e._v(", it is either is not correctly configured, or it has a connection problem.")]),e._v(" "),t("li",[e._v("If the node is online, but the rangefinder sensor channel is not appeared, it means a problem with your PX4 configuration.")]),e._v(" "),t("li",[e._v("If "),t("code",[e._v("uavcan status")]),e._v(" output is fine, but "),t("code",[e._v("Mavlink Inspector")]),e._v(" is not, you can try to type "),t("code",[e._v("listener distance_sensor")]),e._v(". Normally, it should return something:\n"),t("img",{attrs:{src:n(660),alt:"px4_listener_distance_sensor",title:"px4_listener_distance_sensor"}})])]),e._v(" "),t("h2",{attrs:{id:"_6-5-software-versions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-software-versions"}},[e._v("#")]),e._v(" 6.5. Software versions")]),e._v(" "),t("p",[e._v("For latest (shipping) firmware please refer to "),t("RouterLink",{attrs:{to:"/guide/intro/firmware_upload.html"}},[e._v("Update the firmware")]),e._v(" page.")],1),e._v(" "),t("p",[e._v("For all avaliable for Rangefinder Cyphal & DroneCAN releases please check "),t("RouterLink",{attrs:{to:"/guide/rangefinder/"}},[e._v("1. General")]),e._v(" page.")],1),e._v(" "),t("details",[t("summary",[e._v("Click here to expand Legacy (DroneCAN only) firmares")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Version")]),e._v(" "),t("th",[e._v("Description")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("v0.8.19_43c298d "),t("br"),e._v(" Oct 19, 2022")]),e._v(" "),t("td",[e._v("- Add vl53l0x")])]),e._v(" "),t("tr",[t("td",[e._v("v0.5.1_baf6e11 "),t("br"),e._v(" Feb 17, 2022")]),e._v(" "),t("td",[e._v("- Add Garmin Lite v3")])]),e._v(" "),t("tr",[t("td",[e._v("v0.4.8_7c4d9c7 "),t("br"),e._v(" Jan 31, 2022")]),e._v(" "),t("td",[e._v("- Add TF Luna support")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://github.com/RaccoonlabDev/docs/releases/tag/v0.4.5",target:"_blank",rel:"noopener noreferrer"}},[e._v("v0.3.6_830e6ff"),t("OutboundLink")],1),t("br"),e._v("Oct 06, 2021")]),e._v(" "),t("td",[e._v("- Increase measurement rate and add filter to output "),t("br")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://github.com/RaccoonlabDev/docs/releases/tag/v0.3.0-alpha",target:"_blank",rel:"noopener noreferrer"}},[e._v("v0.3.0_alpha_0fe6caf"),t("OutboundLink")],1),t("br"),e._v("Aug 5, 2020")]),e._v(" "),t("td",[e._v("First ever released version. Only sf1xx is supported.")])])])])])])}),[],!1,null,null,null);t.default=o.exports}}]);